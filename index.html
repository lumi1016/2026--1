<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>2025 é—œè¥¿å®¶æ—ä¹‹æ—… - æ——è‰¦å°éŠçµ‚æ¥µç‰ˆ</title>
    <!-- æ¡Œé¢åœ–ç¤ºï¼šç´…é³¥å±… -->
    <link rel="apple-touch-icon" href="https://i.ibb.co/27KXyfSt/image.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700;900&family=Ma+Shan+Zheng&display=swap');
        
        :root {
            --kyoto-red: #B22D15;
            --bamboo-green: #3A4D39;
            --osaka-gold: #D4AF37;
            --washi-bg: #F9F6F0;
            --stay-dark: #1A1A1A;
            --premium-navy: #1E272E;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--washi-bg);
            color: #2D3436;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
            text-align: left;
        }

        .calligraphy { font-family: 'Ma Shan Zheng', cursive !important; }
        .kaity { font-family: 'DFKai-SB', 'æ¨™æ¥·é«”', 'Kaiti TC', 'KaiTi', serif !important; }

        .tab-active {
            background: var(--kyoto-red) !important;
            color: white !important;
            box-shadow: 0 8px 20px rgba(178, 45, 21, 0.35);
            transform: scale(1.08);
        }

        .glass-tool {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }

        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-slideUp { animation: slideUp 0.3s cubic-bezier(0, 0, 0.2, 1) forwards; }
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        .modal-immersive-header {
            height: 320px;
            background-size: cover;
            background-position: center;
            position: relative;
        }

        .modal-immersive-overlay {
            background: linear-gradient(to bottom, rgba(249, 246, 240, 0.1) 0%, rgba(249, 246, 240, 0.9) 100%);
            position: absolute;
            inset: 0;
            z-index: 1;
        }

        .text-shadow-premium {
            text-shadow: 0 0 15px rgba(255, 255, 255, 1), 0 0 5px rgba(255, 255, 255, 0.8);
        }

        .badge-spot { background: #E6F3FF; color: #007AFF; }
        .badge-food { background: #FFF4E6; color: #FF9500; }
        .badge-stay { background: rgba(255, 215, 0, 0.2); color: #FFD700; border: 1px solid rgba(255, 215, 0, 0.3); }
        .badge-check { background: rgba(255, 255, 255, 0.2); color: #FFFFFF; border: 1px solid rgba(255, 255, 255, 0.4); }
        
        .card-stay {
            background-color: var(--stay-dark) !important;
            color: #FFFFFF !important;
            border-left: 6px solid var(--osaka-gold) !important;
        }
        
        .card-check {
            background: var(--premium-navy) !important;
            color: #FFFFFF !important;
            border-left: 6px solid #5758BB !important;
            box-shadow: 0 10px 25px rgba(30, 39, 46, 0.25) !important;
        }

        .btn-press:active { transform: scale(0.92); opacity: 0.8; }
        #stamina-ring { transition: stroke-dashoffset 1.2s ease-out; }
    </style>
</head>
<body class="max-w-md mx-auto shadow-2xl min-h-screen pb-48 relative text-left">

    <!-- Header Section -->
    <header id="main-header" class="bg-[#3A4D39] text-white p-8 rounded-b-[4rem] shadow-2xl relative overflow-hidden min-h-[220px] flex flex-col justify-end transition-all text-left">
        <img id="header-bg" src="https://images.unsplash.com/photo-1590559899731-a382839e5549?auto=format&fit=crop&w=1200&q=80" class="absolute inset-0 w-full h-full object-cover opacity-45 transition-all duration-700">
        <div class="absolute inset-0 bg-gradient-to-t from-[#3A4D39] via-transparent to-transparent opacity-80 text-left"></div>
        <div class="relative z-10 flex justify-between items-end text-left">
            <div class="flex-1 overflow-hidden pb-1 text-left">
                <h1 class="text-4xl font-black kaity text-gray-900 leading-none text-shadow-premium mb-1">é—œè¥¿å°é†‰é†‰</h1>
                <p class="text-xs font-bold text-yellow-100/80 tracking-widest uppercase">Family Luxury Tour 2025</p>
            </div>
            <div class="text-right flex flex-col items-end">
                <p id="weather-city-name" class="text-7xl calligraphy text-yellow-50 leading-none mb-1 drop-shadow-md">--</p>
                <div class="flex items-center justify-end gap-2 pr-1 text-left">
                    <span id="weather-icon-inline" class="text-base opacity-90 text-left"></span>
                    <p id="weather-temp-calligraphy" class="text-4xl calligraphy text-yellow-100 leading-none">--Â°C</p>
                </div>
            </div>
        </div>
    </header>

    <!-- Toolbar -->
    <section class="px-4 -mt-10 relative z-20 flex justify-center gap-2 text-center text-left">
        <button onclick="window.toggleTool('calc')" class="w-[23%] glass-tool p-4 rounded-[2rem] shadow-xl flex flex-col items-center btn-press"><i class="fas fa-calculator text-[--osaka-gold] mb-1.5 text-xl"></i><span class="text-[9px] font-black text-gray-800">åŒ¯ç‡</span></button>
        <button onclick="window.toggleTool('ledger')" class="w-[23%] glass-tool p-4 rounded-[2rem] shadow-xl flex flex-col items-center btn-press"><i class="fas fa-coins text-emerald-600 mb-1.5 text-xl"></i><span class="text-[9px] font-black text-gray-800">è¨˜å¸³</span></button>
        <button onclick="window.toggleTool('trans')" class="w-[23%] glass-tool p-4 rounded-[2rem] shadow-xl flex flex-col items-center btn-press"><i class="fas fa-language text-blue-500 mb-1.5 text-xl"></i><span class="text-[9px] font-black text-gray-800">ç¿»è­¯</span></button>
        <button onclick="window.toggleTool('checklist')" class="w-[23%] glass-tool p-4 rounded-[2rem] shadow-xl flex flex-col items-center btn-press"><i class="fas fa-clipboard-list text-purple-500 mb-1.5 text-xl"></i><span class="text-[9px] font-black text-gray-800">æ¸…å–®</span></button>
    </section>

    <!-- Navigation -->
    <nav class="flex overflow-x-auto whitespace-nowrap px-4 py-8 no-scrollbar sticky top-0 z-40 bg-[--washi-bg]/95 backdrop-blur-md text-left">
        <div class="flex space-x-4 mx-auto px-4 text-left" id="day-nav-container"></div>
    </nav>

    <!-- Main Content Area -->
    <main id="main-content" class="px-6 min-h-[400px] text-left"></main>

    <!-- Modal Container -->
    <div id="tool-modal" class="hidden fixed inset-0 z-[150] flex items-end justify-center bg-black/60 backdrop-blur-md" onclick="if(event.target === this) window.closeModal()">
        <div class="bg-[--washi-bg] w-full max-w-md rounded-t-[3rem] shadow-2xl overflow-hidden animate-slideUp max-h-[92vh] flex flex-col relative text-left">
            <div class="w-12 h-1 bg-gray-300 rounded-full mx-auto mt-4 mb-2"></div>
            <button onclick="window.closeModal()" class="absolute top-6 right-6 z-[999] w-12 h-12 rounded-full bg-black/20 text-white flex items-center justify-center active:scale-90 shadow-lg backdrop-blur-md border border-white/20">
                <i class="fas fa-times text-xl text-left"></i>
            </button>
            <div id="modal-body" class="flex-1 overflow-y-auto no-scrollbar pb-10 text-left"></div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="fixed bottom-6 left-1/2 -translate-x-1/2 w-[92%] max-w-sm bg-white/95 backdrop-blur-3xl rounded-[2.5rem] shadow-2xl border border-white p-5 z-50 flex justify-between items-center px-10 safe-pb text-left">
        <a href="tel:0901234567" class="flex flex-col items-center">
            <div class="w-12 h-12 rounded-full bg-red-50 text-[--kyoto-red] flex items-center justify-center mb-1 shadow-sm text-center text-left"><i class="fas fa-phone-alt text-xl text-left"></i></div>
            <span class="text-[8px] font-black text-gray-500 uppercase tracking-tighter text-center">è¯ç¹«å¸æ©Ÿ</span>
        </a>
        <div class="text-center relative -top-2">
            <div class="relative w-16 h-16 mx-auto text-center text-left text-left">
                <svg class="w-full h-full transform -rotate-90">
                    <circle cx="32" cy="32" r="28" stroke="#f0f0f0" stroke-width="4" fill="transparent" />
                    <circle id="stamina-ring" cx="32" cy="32" r="28" stroke="var(--kyoto-red)" stroke-width="4" fill="transparent" stroke-dasharray="176" stroke-dashoffset="176" />
                </svg>
                <div class="absolute inset-0 flex items-center justify-center font-black text-[--kyoto-red] text-sm text-center text-left text-left text-left text-left"><span id="stamina-val">--%</span></div>
            </div>
            <span class="text-[8px] font-black text-gray-400 uppercase tracking-widest text-center">å®¶æ—é«”åŠ›</span>
        </div>
        <button onclick="window.toggleTool('trans')" class="flex flex-col items-center text-center">
            <div class="w-12 h-12 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center mb-1 shadow-sm font-black text-center text-left"><i class="fas fa-robot text-xl text-left"></i></div>
            <span class="text-[8px] font-black text-gray-500 uppercase tracking-tighter text-center text-left">AI åŠ©æ‰‹</span>
        </button>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, onSnapshot, addDoc, deleteDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const apiKey = ""; 

        // é£¯åº—è©³ç´°ä»‹ç´¹æ–‡æ¡ˆ
        const mimaruIntro = `å°ˆç‚ºå®¶æ—æ—…è¡Œèˆ‡é•·è¼©è¨­è¨ˆçš„é«˜è³ªæ„Ÿå…¬å¯“é£¯åº—ã€‚æˆ¿å…§ä¸åªæ˜¯ç¡è¦ºçš„ç©ºé–“ï¼Œæ›´æ“æœ‰ã€Œå®¶åº­ä¸­å¿ƒã€æ¦‚å¿µçš„å¤§å‹æœ¨è³ªé¤æ¡Œï¼Œè®“å…¨å®¶äººåœ¨çµæŸç¹å¿™è¡Œç¨‹å¾Œï¼Œèƒ½åœèšåœ¨æ­¤åˆ†äº«è‡¨ç©ºåŸè²·å›ä¾†çš„æˆ°åˆ©å“ï¼Œäº«å—å¦‚å®¶èˆ¬çš„è‡ªåœ¨ã€‚å‚™æœ‰å®Œæ•´å»šæˆ¿è¨­æ–½èˆ‡æ´—è¡£è¨­å‚™ã€‚åœ°å€ï¼šã€’542-0081 å¤§é˜ªåºœä¸­å¤®å€å—èˆ¹å ´2-4-18ã€‚`;
        const mimaruGuide = `ã€é¦–å¸­å°éŠé»è©•ã€‘é£¯åº—åœ°ç†ä½ç½®çµ•ä½³ï¼Œä¸‹æ¨“å³æ˜¯ã€ŒLifeã€å¤§å‹è¶…å¸‚ï¼Œé•·è¼©å¯ä»¥è¦ªè‡ªæŒ‘é¸ç”¢åœ°ç›´é€çš„æ—¥æœ¬æœç‰©ï¼ˆå¦‚ï¼šå¤éƒ½è¯è‰è“ï¼‰ã€‚æ­¥è¡Œ 5 åˆ†é˜å³æŠµå¿ƒé½‹æ©‹æ ¸å¿ƒå€ï¼Œé€›ç´¯äº†éš¨æ™‚èƒ½å›é£¯åº—å°æ†©ã€‚é›»è©±ï¼š6435282209`;
        
        const piecesIntro = `ä»¥ã€Œæ—…é€”ä¸­çš„æ‹¼åœ–ã€ç‚ºåï¼Œé€™é–“äº¬éƒ½ç¾å­¸é£¯åº—å¼·èª¿ã€Œç©ºé–“ã€èˆ‡ã€Œå„€å¼æ„Ÿã€ã€‚å®¢æˆ¿æ¯”ä¾‹é è¶…ä¸€èˆ¬æ—¥æœ¬å¸‚å€é£¯åº—ï¼Œå…¨æˆ¿å‹é…ç½®ç²¾å“ã€ŒBaludaã€æ‰‹æ²–å£ºèˆ‡çƒ¤éºµåŒ…æ©Ÿï¼Œç‡Ÿé€ å‡ºäº¬éƒ½ç§äººå®…é‚¸èˆ¬çš„è³ªæ„Ÿå„€å¼æ„Ÿã€‚å¤§é¢ç©çš„æ´»å‹•ç©ºé–“èƒ½è¼•é¬†æ”¤é–‹å…¨åœ˜è¡Œæã€‚åœ°å€ï¼šã€’601-8003 äº¬éƒ½åºœå—å€æ±ä¹æ¢å®¤ç”º 9-4ã€‚`;
        const piecesGuide = `ã€é¦–å¸­å°éŠé»è©•ã€‘é£¯åº—é„°è¿‘äº¬éƒ½è»Šç«™ã€Œå…«æ¢å£ã€ï¼Œæ˜¯æ­ä¹˜æ©Ÿå ´å¿«ç·šå·´å£«èˆ‡ AEON Mall çš„æœ€ä½³æˆ°ç•¥é»ã€‚å¤œæ™šå»ºè­°åœ¨æˆ¿å…§ç”¨ç²¾å“å®¶é›»æ²–æ¯èŒ¶ï¼Œäº«å—å¤éƒ½å¯§éœã€‚é›»è©±ï¼š6236190418`;

        // å…¨å±€è¡Œç¨‹è³‡æ–™åº« (V8.5 çµ‚æ¥µä¿®è¨‚ç‰ˆ)
        const tourData = {
            1: { 
                label: "Day 1 å¤§é˜ªãƒ»é–‹å ´å¼·æ”»", loc: "å¤§é˜ª", engLoc: "Osaka", img: "https://images.unsplash.com/photo-1590559899731-a382839e5549?auto=format&fit=crop&w=1200&q=80", stamina: 80, 
                events: [
                    { t: "09:20", s: "æ¡ƒåœ’æ©Ÿå ´ | æ˜Ÿå®‡ JX822", type: "äº¤é€š", i: "plane-departure", n: "ç²¾å“ç´šèˆªç©ºå•Ÿç¨‹ã€‚", m: "Taoyuan+Airport", imgDetail: "https://images.unsplash.com/photo-1530521954074-e64f6810b32d?auto=format&fit=crop&w=800", detailTitle: "æ˜Ÿå®‡èˆªå‘é—œè¥¿", intro: `æ˜Ÿå®‡èˆªç©º JX822 æ¡ç”¨ A321neo æ©Ÿå‹ã€‚æ©Ÿä¸Šæœå‹™èˆ‡ç²¾å“å…§è£æ·±å—é•·è¼©è®šè¨±ã€‚æ©Ÿä¸Šé…ç½® 4K è§¸æ§è¢å¹•ï¼Œå»ºè­°é ç´„æ±æ–¹ç´ é£Ÿé¤æˆ–èƒ¡åŒç‡’è‚‰é¤é£²ã€‚`, aiGuide: `é¦–å¸­å°éŠï¼šæ¡ƒåœ’äºŒèˆªå ±åˆ°æ«ƒå°é€šå¸¸ä½æ–¼ 5-7 è™Ÿã€‚ç²¾å“èˆªç·šçš„æ°£æ°›èƒ½è®“å…¨å®¶æœ‰å€‹å®Œç¾çš„æ—…è¡Œé–‹é ­ã€‚` },
                    { t: "12:50", s: "æŠµé”é—œè¥¿æ©Ÿå ´ | KIX", type: "äº¤é€š", i: "plane-arrival", n: "é€šé—œå…¥å¢ƒï¼Œå±•é–‹å„ªé›…æ—…ç¨‹ã€‚", m: "KIX", imgDetail: "https://images.unsplash.com/photo-1569154941061-e231b4725ef1?auto=format&fit=crop&w=800", detailTitle: "é—œè¥¿å…¥å¢ƒ", intro: `å®Œæˆé€šé—œç¨‹åºå¾Œé ˜å–è¡Œæã€‚åœ¨æ­¤æ‚¨å¯ä»¥é¸æ“‡å°‡å¤§è¡Œæå¯„å­˜åœ¨æ©Ÿå ´ï¼Œç›´æ¥å‰å¾€è‡¨ç©ºåŸ Outletã€‚` },
                    { t: "15:00", s: "è‡¨ç©ºåŸ Outlet (Rinku)", type: "è³¼ç‰©", i: "shopping-cart", n: "é—œè¥¿æœ€å¤§è³¼ç‰©è–åœ°ã€‚Sky Shuttle ç›´é”ã€‚", m: "Rinku+Premium+Outlets", imgDetail: "https://images.unsplash.com/photo-1441986300917-64674bd600d8?auto=format&fit=crop&w=800", detailTitle: "è‡¨ç©ºåŸè³¼ç‰©æ”»ç•¥", intro: `åœ¨æ©Ÿå ´èˆªç«™å¤–çš„å·´å£«ç«™æ­ä¹˜ã€ŒSky Shuttleã€ï¼Œç´„ 15 åˆ†é˜ç›´é” Outlet é–€å£ã€‚åŒ…å« 200 å¤šå€‹åœ‹å…§å¤–çŸ¥åå“ç‰Œï¼Œè·¯é¢é–‹é—Šï¼Œéå¸¸é©åˆé•·è¼©æ…¢æ­¥é€›è¡—ã€‚`, aiGuide: `è³‡æ·±å°éŠè§€é»ï¼šè½åœ°ç¬¬ä¸€ç«™ä¾†è‡¨ç©ºåŸæ˜¯æœ€çœåŠ›çš„å®‰æ’ã€‚å–®ç¨‹ 300 æ—¥åœ“çš„ Sky Shuttle æ¯åŠå°æ™‚ä¸€ç­ï¼Œæ¯”åœ°éµè½‰ä¹˜æ›´çœé«”åŠ›ã€‚` },
                    { t: "19:00", s: "é£¯åº—å…¥ä½ | å¿ƒé½‹æ©‹ Check-in", type: "ä½å®¿", i: "hotel", n: "å…¥ä½ MIMARU å¤§é˜ªå¿ƒé½‹æ©‹ NORTHã€‚", m: "MIMARU+Osaka+Shinsaibashi+North", imgDetail: "https://i.ibb.co/Wv8V9WDM/image.jpg", detailTitle: "å¤§é˜ªå¥¢è¯å¯“æ‰€", intro: mimaruIntro, aiGuide: mimaruGuide, reserved: true },
                    { t: "21:00", s: "ğŸ“ å®µå¤œæƒè²¨èˆ‡è‰è“æ”»ç•¥", type: "è³¼ç‰©", i: "shopping-bag", n: "Life è¶…å¸‚æ¡è²·ç•¶å­£åç‰©ã€‚", m: "Life+Supermarket", imgDetail: "https://images.unsplash.com/photo-1464960710542-5674033ed5f6?auto=format&fit=crop&w=800", detailTitle: "å¤§é˜ªå®µå¤œæ™‚å…‰", intro: `å‰å¾€é£¯åº—æ—çš„ Life è¶…å¸‚ï¼Œç›®æ¨™é–å®šå¤éƒ½è¯ã€æ·¡é›ªç­‰æ—¥æœ¬åç”¢è‰è“ã€‚å…¨å®¶äººèšåœ¨é£¯åº—å®¢å»³äº«ç”¨ç”œé»ï¼Œæ˜¯æœ€æ£’çš„æ­¡è¿ç¦®ã€‚` }
                ] 
            },
            2: { 
                label: "Day 2 å½±åŸãƒ»å°Šæ¦®ç‹‚æ­¡", loc: "å¤§é˜ª", engLoc: "Osaka", img: "https://i.ibb.co/Fb2MnJ7h/image.jpg", stamina: 40, 
                events: [
                    { t: "08:00", s: "VIP å°ˆå±¬å…¥å£å ±åˆ°", type: "é«”é©—", i: "crown", n: "å°Šæ¦®å°è¦½å•Ÿç¨‹ï¼Œå°ˆå±¬ä¼‘æ¯å®¤ã€‚", m: "USJ+VIP+Entrance", imgDetail: "https://images.unsplash.com/photo-1590233461421-47701389772d?auto=format&fit=crop&w=800", detailTitle: "VIP å°ˆå±¬æœå‹™", intro: `å»ºè­°åœ¨é£¯åº—æ¥é€å€ä¸‹è»Šã€‚å…¥åœ’å¾Œç›´å…¥è±ªè¯ä¼‘æ¯å®¤ï¼Œé ˜å–é ¸éŠï¼Œå°è¦½å‰å…ˆäº«ç”¨å°ˆæ¥­å’–å•¡ã€‚`, reserved: true },
                    { t: "09:30", s: "VIP 3 å°æ™‚å°è¦½ (åˆ¶éœ¸ä»»å¤©å ‚)", type: "æ™¯é»", i: "star", n: "æ”»ç•¥ä»»å¤©å ‚å€èˆ‡å°å°å…µä¹˜è»ŠéŠã€‚", m: "Super+Nintendo+World", imgDetail: "https://images.unsplash.com/photo-1624316812891-b3b3a6230919?auto=format&fit=crop&w=1200", detailTitle: "å…æ’éšŠæ¥µé€Ÿå°èˆª", intro: `è¨­æ–½ï¼šå¤§é‡‘å‰›ç¤¦è»Šã€ç‘ªåˆ©æ­è³½è»Šã€è€€è¥¿å†’éšªã€‚è®Šæ›´æé†’ï¼šå› å¤§ç™½é¯Šç¶­ä¿®ï¼Œæ–¹æ¡ˆç”±ã€Œå°å°å…µç˜‹ç‹‚ä¹˜è»ŠéŠã€æ›¿ä»£ã€‚12:30 åœ¨å°å°å…µæ¨‚åœ’é™„è¿‘çµæŸã€‚`, aiGuide: `å°éŠå»ºè­°ï¼šè€€è¥¿å†’éšªè¦–è§’æœ€é–‹é—Šï¼Œæ˜¯æ‹ä¸‹æ•´å€‹ç‘ªåˆ©æ­åœ’å€èˆ‡å…¨å®¶åˆå½±çš„é»ƒé‡‘ä½ç½®ã€‚`, accessible: true },
                    { t: "12:30", s: "ğŸ“ A, B ç¬¬ä¸€æ³¢å°éŠæˆ²æŒ‘æˆ°", type: "é«”é©—", i: "gamepad", n: "å°å°å…µæ”¤ä½è´å–ç©å¶ã€‚", m: "Minion+Park+Games", imgDetail: "https://images.unsplash.com/photo-1590233461421-47701389772d?auto=format&fit=crop&w=800", detailTitle: "å°å°å…µæ”¤ä½æ”»ç•¥", intro: `è¶å°è¦½çµæŸèˆˆå¥®æ„Ÿï¼Œç© 1-2 å€‹éŠæˆ²ã€‚çå“å…¨æ˜¯å°å°å…µï¼ğŸ“ A é¦™è•‰å¡å·´é‚£ã€ğŸ“ B å¤ªç©ºæ®ºæ‰‹ã€‚` },
                    { t: "13:00", s: "SAIDO å½©é“ï¼šæ—¥å¼åˆé¤", type: "ç¾é£Ÿ", i: "utensils", n: "æ—¥å¼å®šé£Ÿï¼Œé•·è¼©é«”åŠ›æ¢å¾©é¦–é¸ã€‚", m: "SAIDO+USJ", imgDetail: "https://images.unsplash.com/photo-1544025162-d76694265947?auto=format&fit=crop&w=800", detailTitle: "å½©é“ç²¾ç·»æ–™ç†", intro: `ä½æ–¼ç´ç´„å€ã€‚æ—¥å¼å®šé£Ÿæœ€åˆé•·è¼©èƒƒå£ã€‚å…¨å“¡å¯ä½¿ç”¨ 1500å††é¤åˆ¸ä¸¦äº« 10% æŠ˜æ‰£ã€‚`, aiGuide: `å°éŠè§€é»ï¼šç›¸æ¯”æ¼¢å ¡ï¼Œå®šé£Ÿæ›´æœ‰åŠ©æ–¼æ¢å¾©é«”åŠ›ã€‚ç’°å¢ƒæ¥µå„ªé›…ã€‚`, reserved: true },
                    { t: "14:30", s: "25 é€±å¹´æ…¶å…¸éŠè¡Œï¼šå°Šæ¦®å¸­", type: "é«”é©—", i: "music", n: "VIP å¸­ä½è§€è³ï¼Œå…¨é«”å¤§åˆç…§ã€‚", m: "USJ+Parade", imgDetail: "https://images.unsplash.com/photo-1590233461421-47701389772d?auto=format&fit=crop&w=800", detailTitle: "æ…¶å…¸éŠè¡Œè¦–é‡", intro: `èˆ‡çš®å¡ä¸˜ã€ç‘ªåˆ©æ­ä¸€èµ·è·³èˆï¼Œé€™æ˜¯æ‹ 8 äººå…¨åœ˜å¤§åˆç…§çš„æœ€ä½³æ™‚åˆ»ï¼` },
                    { t: "15:30", s: "ğŸ“ C, D æº«é¦¨è¦ªå­éŠæˆ²æ™‚é–“", type: "é«”é©—", i: "gift", n: "æ‹‹ç¡¬å¹£èˆ‡ä¸Ÿç½å­éŠæˆ²ã€‚", m: "Universal+Wonderland", imgDetail: "https://images.unsplash.com/photo-1590233461421-47701389772d?auto=format&fit=crop&w=800", detailTitle: "æº«é¦¨æ”¤ä½", intro: `å‰å¾€ğŸ“ C è¦ªå–„æ‘æˆ–ğŸ“ D ç’°çƒå¥‡å¢ƒï¼ˆç©æ³•æœ€ç°¡å–®ï¼‰ï¼Œé•·è¼©è´çæˆåŠŸç‡æœ€é«˜ã€‚` },
                    { t: "16:30", s: "4 å¼µå¿«é€šè‡ªç”±æ”»ç•¥", type: "é«”é©—", i: "ticket-alt", n: "æŸ¯å— 4Dã€å“ˆåˆ©æ³¢ç‰¹ã€åŸå ¡é»ç‡ˆã€‚", m: "The+Wizarding+World+of+Harry+Potter", imgDetail: "https://images.unsplash.com/photo-1590233461421-47701389772d?auto=format&fit=crop&w=800", detailTitle: "è‡ªç”±å¿«é€šæ™‚åˆ»", intro: `æ¨è–¦æŸ¯å— 4D (åŠ‡å ´ä¼‘æ¯é¦–é¸) èˆ‡å“ˆåˆ©æ³¢ç‰¹ã€‚å‚æ™šåŸå ¡é»ç‡ˆæ°£æ°›çµ•ä½³ã€‚`, aiGuide: `å°éŠæé†’ï¼šæŸ¯å—ç§€æ˜¯çµ•ä½³çš„é›™è…¿æ•‘æ´é»ã€‚` },
                    { t: "21:00", s: "è¿”å›é£¯åº—ä¼‘æ¯", type: "ä½å®¿", i: "hotel", n: "å¸¶è‘—æˆ°åˆ©å“å› MIMARU å¤§é˜ªä¼‘æ¯ã€‚", m: "MIMARU+Osaka+Shinsaibashi+North", imgDetail: "https://i.ibb.co/Wv8V9WDM/image.jpg", detailTitle: "çµæŸå½±åŸæ—¥", intro: `åœ“æ»¿çµæŸ USJ ä¸€æ—¥éŠï¼Œæ­è¨ˆç¨‹è»Šæˆ–åŒ…è»Šå›é£¯åº—ä¼‘æ¯ã€‚ä»Šæ™šæ³¡å€‹ç†±æ°´æ¾¡æ”¾é¬†èº«é«”ã€‚` }
                ] 
            },
            3: { 
                label: "Day 3 å¥ˆè‰¯ãƒ»ç¥é¹¿æ–‡åŒ–", loc: "å¥ˆè‰¯", engLoc: "Nara", img: "https://i.ibb.co/Rp5Zt2vJ/image.jpg", stamina: 70, 
                events: [
                    { t: "09:00", s: "å¤§é˜ªé£¯åº—åŒ…è»Šå‡ºç™¼", type: "äº¤é€š", i: "car", n: "ç›´é”å¥ˆè‰¯ã€‚è¡Œç¨‹èˆ’é©ç„¡æ†‚ã€‚", m: "MIMARU+Osaka", imgDetail: "https://i.ibb.co/Wv8V9WDM/image.jpg", detailTitle: "å¥ˆè‰¯å•Ÿç¨‹" },
                    { t: "10:00", s: "å¥ˆè‰¯å…¬åœ’ / æ±å¤§å¯ºåƒæ‹œ", type: "æ™¯é»", i: "hippo", n: "é¤µé¹¿èˆ‡åƒæ‹œéœ‡æ’¼å¤§ä½›ã€‚", m: "Todaiji", imgDetail: "https://i.ibb.co/ksgDLctq/image.jpg", detailTitle: "æ±å¤§å¯ºåƒæ‹œ", intro: `æ±å¤§å¯ºè¨­æœ‰ç„¡éšœç¤™å¡é“ã€‚`, aiGuide: `ã€é‡è¦æŒ‡ä»¤ã€‘è«‹å¸æ©Ÿåœåœ¨ã€Œå—å¤§é–€ã€æœ€è¿‘è™•æ”¾äººï¼Œç¯€çœæ­¥è¡Œé«”åŠ›ã€‚`, accessible: true },
                    { t: "12:00", s: "å¥ˆè‰¯å®šé£Ÿåˆé¤", type: "ç¾é£Ÿ", i: "utensils", n: "å¸æ©Ÿæ¨è–¦å¥½åœå¥½èµ°é¤å»³ã€‚", m: "Nara+Lunch", imgDetail: "https://i.ibb.co/hRXB7hKW/image.jpg", detailTitle: "å¥ˆè‰¯é£Ÿæ™‚", aiGuide: `å°éŠå®åš€ï¼šè«‹å¸æ©Ÿæ¨è–¦å¥½åœè»Šã€æ­¥è¡Œè·é›¢æ¥µçŸ­çš„é¤å»³ã€‚` },
                    { t: "13:30", s: "ä¸­è°·å ‚æ—éº»ç³¬", type: "é«”é©—", i: "store", n: "è§€è³é«˜é€Ÿæ—éº»ç³¬è¡¨æ¼”ã€‚", m: "Nakatanidou", imgDetail: "https://i.ibb.co/vx1ptgT0/image.jpg", detailTitle: "ä¸­è°·å ‚æ—é¤…", intro: `ä½æ–¼è¿‘éµå¥ˆè‰¯ç«™é™„è¿‘ï¼Œæ‹ç…§ä¸¦å“è£½å“ã€‚` },
                    { t: "14:30", s: "å®‡æ²» å¹³ç­‰é™¢ & æŠ¹èŒ¶ä¸‹åˆèŒ¶", type: "æ™¯é»", i: "leaf", n: "è·¯é¢å¹³æ•´ä¸–éºæ•£ç­–ã€‚", m: "Byodoin", imgDetail: "https://i.ibb.co/vx1ptgT0/image.jpg", detailTitle: "å®‡æ²»æŠ¹èŒ¶é¦™", intro: `å¹³ç­‰é™¢è·¯å¾‘å¹³ç·©ã€‚çµæŸå¾Œå®‰æ’æ­£çµ±æŠ¹èŒ¶åˆèŒ¶ã€‚`, aiGuide: `è³‡æ·±å°éŠï¼šé€™æ˜¯é—œè¥¿æœ€é©åˆé•·è¼©ã€å„ªé›…ä½è² æ“”çš„ä¸–éºé»ã€‚` },
                    { t: "17:00", s: "å…¥ä½ï¼šäº¬éƒ½ 22 Pieces é£¯åº—", type: "ä½å®¿", i: "hotel", n: "äº¬éƒ½è»Šç«™æ—è¨­è¨ˆåé‚¸ã€‚", m: "22+pieces+Kyoto", imgDetail: "https://i.ibb.co/svMxj7z5/image.jpg", detailTitle: "äº¬éƒ½å¥¢è¯æ³Šï¼š22 pieces", intro: piecesIntro, aiGuide: piecesGuide, reserved: true }
                ] 
            },
            4: { 
                label: "Day 4 äº¬éƒ½ãƒ»æ·±åº¦å·¡ç¦®", loc: "äº¬éƒ½", engLoc: "Kyoto", img: "https://i.ibb.co/PzY0SDLD/image.jpg", stamina: 65, 
                events: [
                    { t: "09:00", s: "äº¬éƒ½é£¯åº—åŒ…è»Šå‡ºç™¼", type: "äº¤é€š", i: "car", n: "å…¨æ—¥åŒ…è»Šï¼Œå„ªé›…æš¢éŠå¤éƒ½ã€‚", m: "22+pieces+Kyoto", imgDetail: "https://i.ibb.co/svMxj7z5/image.jpg", detailTitle: "äº¬éƒ½å•Ÿç¨‹" },
                    { t: "09:30", s: "é‡‘é–£å¯ºåƒæ‹œ", type: "æ™¯é»", i: "sun", n: "é–ƒè€€èˆåˆ©æ®¿ã€‚å¹³è·¯æ¼«æ­¥ã€‚", m: "Kinkakuji", imgDetail: "https://i.ibb.co/nN541XSx/image.jpg", detailTitle: "é‡‘é–£è€€çœ¼", intro: `å¯ºå…§æ­¥é“å¹³å¦ã€‚æ­¤æ™‚å…‰ç·šç›´å°„é‡‘ç®”æœ€ç‚ºé–ƒäº®ã€‚`, aiGuide: `å°éŠè§€é»ï¼šä½é«”åŠ›æ¶ˆè€—ã€é«˜è¦–è¦ºäº«å—çš„é¦–é¸ã€‚` },
                    { t: "11:00", s: "ä¼è¦‹ç¨»è·å¤§ç¤¾", type: "æ™¯é»", i: "torii-gate", n: "åƒæœ¬é³¥å±…å…¥å£æ‹ç…§æ‹ç…§ã€‚", m: "Fushimi", imgDetail: "https://images.unsplash.com/photo-1478436127897-769e1b3f0f36?auto=format&fit=crop&w=800", detailTitle: "åƒæœ¬é³¥å±…", aiGuide: `ã€é—œéµã€‘å…¥å£æ‹ç…§å³æ’¤ï¼Œä¸çˆ¬å±±ã€‚éš¨å¾Œé€›é€›å‘¨é‚Šå……æ»¿é¢¨å‘³çš„å•†åº—è¡—ã€‚` },
                    { t: "14:30", s: "æ¸…æ°´å¯º & ç·©ä¸‹å¡æ•£ç­–", type: "æ™¯é»", i: "temple", n: "æ¸…æ°´èˆå°åƒæ‹œèˆ‡è€è¡—æ•£æ­¥ã€‚", m: "Kiyomizu", imgDetail: "https://i.ibb.co/8nLR731B/image.jpg", detailTitle: "æ¸…æ°´èˆå°", intro: `é †è‘—äºŒå¹´å‚ã€ä¸‰å¹´å‚ã€Œç·©ä¸‹å¡ã€æ¼«æ­¥ã€‚`, aiGuide: `ã€é‡è¦æŒ‡ä»¤ã€‘å¸æ©Ÿé–‹åˆ°ã€Œæœ€ä¸Šæ–¹åœè»Šå ´ã€æ”¾äººã€‚é•·è¼©èµ° 3 åˆ†é˜å³æŠµèˆå°ï¼Œé¿é–‹ä¸‹æ–¹é•·å¡ã€‚` },
                    { t: "16:30", s: "ç¥‡åœ’ / èŠ±è¦‹å°è·¯ / é´¨å·", type: "æ™¯é»", i: "walking", n: "å¤éƒ½è€è¡—é¢¨æƒ…æ¼«æ­¥ã€‚", m: "Gion", imgDetail: "https://i.ibb.co/BKT0rMnc/image.jpg", detailTitle: "äº¬éƒ½è¡—é“æƒ…æ‡·" },
                    { t: "18:30", s: "é€å›é£¯åº—æˆ–æŒ‡å®šé¤å»³", type: "ä½å®¿", i: "hotel", n: "äº¬éƒ½è³ªæ„Ÿå±…ã€‚é€£æ³Šç¬¬äºŒæ™šã€‚", m: "22+pieces+Kyoto", imgDetail: "https://i.ibb.co/svMxj7z5/image.jpg", detailTitle: "äº¬éƒ½è³ªæ„Ÿå±…" }
                ] 
            },
            5: { 
                label: "Day 5 åµå±±ãƒ»æ¼«æ´»è¡Œç¨‹", loc: "äº¬éƒ½", engLoc: "Kyoto", img: "https://i.ibb.co/JFxL6W1q/image.jpg", stamina: 75, 
                events: [
                    { t: "08:40", s: "è¨ˆç¨‹è»Šç›´é€åµ¯å³¨è»Šç«™", type: "äº¤é€š", i: "taxi", n: "é ç´„å…©å°è¨ˆç¨‹è»Šã€‚ç›´é”çœé«”åŠ›ã€‚", m: "Torokko+Saga", imgDetail: "https://i.ibb.co/svMxj7z5/image.jpg", detailTitle: "åµå±±å•Ÿç¨‹", aiGuide: `ã€æˆ°è¡“ã€‘25åˆ†é˜ç›´é”ï¼Œé¿é–‹ JR è»Šç«™å…§é•·è·é›¢æ­¥è¡Œã€‚` },
                    { t: "09:30", s: "åµå±±å°ç«è»Š (åµ¯å³¨ â” é¾œå²¡)", type: "é«”é©—", i: "train", n: "å³½è°·ç¾æ™¯ã€‚ç›´æ¥ååˆ°çµ‚é»é¾œå²¡ã€‚", m: "Kameoka", imgDetail: "https://images.unsplash.com/photo-1545569341-9eb8b30979d9?auto=format&fit=crop&w=800", detailTitle: "è§€å…‰å°ç«è»Š", aiGuide: `ã€è­¦å‘Šã€‘å¼·çƒˆå»ºè­°ä¸è¦åœ¨ã€Œä¿æ´¥å³½ç«™ã€ä¸‹è»Šï¼Œéšæ¢¯ç„¡æ•¸ç„¡é›»æ¢¯ã€‚è«‹ååˆ°çµ‚é»é¾œå²¡æ¬£è³å…¨æ™¯ã€‚` },
                    { t: "10:00", s: "é¾œå²¡ç”°é‡å¹³è·¯æ•£æ­¥", type: "äº¤é€š", i: "walking", n: "é¾œå²¡ç«™ â” JR é¦¬å €ç«™ã€‚èˆ’é©æ•£ç­–ã€‚", m: "JR+Umahori", imgDetail: "https://images.unsplash.com/photo-1545569341-9eb8b30979d9?auto=format&fit=crop&w=800", detailTitle: "ç”°é‡æ…¢è¡Œ", intro: `è·¯ç¨‹ç´„ 600 å…¬å°ºï¼Œè·¯é¢å¹³ç·©ä¸”æœ‰ç”°é‡é¢¨å…‰ã€‚éš¨å¾Œæ­ JR è¿”å›åµ¯å³¨åµå±±ã€‚` },
                    { t: "10:30", s: "å¤©é¾å¯º (åŒ—é–€é€²å…¥)", type: "æ™¯é»", i: "torii-gate", n: "æ›¹æºæ± åº­åœ’ä¸‹å¡å‹•ç·šã€‚", m: "Tenryu-ji", imgDetail: "https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?auto=format&fit=crop&w=800", detailTitle: "å¤©é¾å¯ºåƒæ‹œ", aiGuide: `ã€ç¥æº–å‹•ç·šã€‘å¾åŒ—é–€é€²æ­£é–€å‡ºã€‚é€™æ˜¯ã€Œä¸‹å¡è·¯å¾‘ã€ï¼Œé«”åŠ›è² æ“”æœ€å°ã€‚` },
                    { t: "11:30", s: "ç«¹æ—å°å¾‘ (æœ€ç¾æ®µ)", type: "æ™¯é»", i: "leaf", n: "å¹³å¦é™°æ¶¼çš„æ‹ç…§è–åœ°ã€‚", m: "Bamboo+Forest", imgDetail: "https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?auto=format&fit=crop&w=800", detailTitle: "ç«¹æ—æ·±è™•", intro: `å¾åŒ—ç«¯é€²å…¥ï¼Œè·¯å¾‘å¹³å¦å¥½æ‹ã€‚` },
                    { t: "12:15", s: "åµå±±å¤§è¡—åˆé¤", type: "ç¾é£Ÿ", i: "utensils", n: "è±†è…æ–™ç†å®šé£Ÿååº—ã€‚", m: "Arashiyama+Main+Street", imgDetail: "https://images.unsplash.com/photo-1512832935301-df7ad7d4986c?auto=format&fit=crop&w=800", detailTitle: "åµå±±æ¨‚é£Ÿ", aiGuide: `å°éŠæ¨è–¦ï¼šå¤©é¾å¯ºæ­£é–€å£å‡ºä¾†å°±æ˜¯å¤§è¡—ã€‚æ¨è–¦å“åšã€Œç¨»ã€æˆ–ã€Œåµ¯å³¨é‡ã€è±†è…æ–™ç†ã€‚` },
                    { t: "14:30", s: "å°Šæ¦®äººåŠ›è»Šé«”é©—", type: "é«”é©—", i: "walking", n: "ç¹è¡Œå¹½éœç§å¯†è·¯ç·šã€‚", m: "Rickshaw+Arashiyama", imgDetail: "https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?auto=format&fit=crop&w=800", detailTitle: "äººåŠ›è»Šæ™‚å…‰", aiGuide: `é€™æ™‚é•·è¼©ç´¯äº†ï¼Œå®‰æ’äººåŠ›è»Šä»£æ­¥æ˜¯æœ€æœ‰é«”é¢çš„é«”è²¼ã€‚` },
                    { t: "16:00", s: "% Arabica å’–å•¡åˆå¾Œ", type: "ç¾é£Ÿ", i: "coffee", n: "æ©‹é‚Šç¾æ™¯èˆ‡ç²¾å“å’–å•¡ã€‚", m: "Arabica+Arashiyama", imgDetail: "https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?auto=format&fit=crop&w=800", detailTitle: "åµå±±åˆå¾Œ" },
                    { t: "18:00", s: "AEON Mall KYOTO è³¼ç‰©", type: "è³¼ç‰©", i: "shopping-bag", n: "å¤§å‹å•†å ´æ¡è²·æœ€å¾Œç´€å¿µå“ã€‚", m: "AEON+Mall+Kyoto", imgDetail: "https://i.ibb.co/svMxj7z5/image.jpg", detailTitle: "äº¬éƒ½æœ€å¾Œæ¡è²·", aiGuide: `å°éŠé»è©•ï¼šå•†å ´å°±åœ¨ 22 Pieces é™„è¿‘ï¼Œæ™šé¤èˆ‡æœ€å¾Œè£œè²¨éå¸¸æ–¹ä¾¿ã€‚` }
                ] 
            },
            6: { 
                label: "Day 6 è³¦æ­¸ãƒ»å¹³å®‰è¿”å°", loc: "äº¬éƒ½", engLoc: "Kyoto", img: "https://i.ibb.co/ccRs1FZB/image.jpg", stamina: 95, 
                events: [
                    { t: "09:00", s: "Limousine Bus æ©Ÿå ´å·´å£«", type: "äº¤é€š", i: "bus", n: "å…«æ¢å£ç›´é” KIX èˆªå»ˆé–€å£ã€‚", m: "Kyoto+Station+Bus", imgDetail: "https://i.ibb.co/svMxj7z5/image.jpg", detailTitle: "å¥¢è¯å›ç¨‹æ¥é§", intro: `é£¯åº— 22 Pieces æ­¥è¡Œ 5-8 åˆ†é˜å³å¯é”å·´å£«ä¹˜è»Šè™•ã€‚ç›´é”æ©Ÿå ´é›¢å¢ƒå¤§å»³ä¸‹è»Šå³æ«ƒå°ã€‚`, aiGuide: `è³‡æ·±å°éŠé»è©•ï¼šå…æ¬è¡Œæã€å…æ›æ¨“å±¤ï¼Œé€™æ˜¯å°é•·è¼©æœ€è²¼å¿ƒçš„å®‰æ’ã€‚` },
                    { t: "14:00", s: "é—œè¥¿æ©Ÿå ´èµ·é£› | JX823", type: "äº¤é€š", i: "plane-departure", n: "æ»¿è¼‰å›æ†¶å¹³å®‰è¿”å°ã€‚", m: "KIX", imgDetail: "https://images.unsplash.com/photo-1436491865332-7a61a109c0f3?auto=format&fit=crop&w=800", detailTitle: "å¹³å®‰è¿”å°" }
                ] 
            }
        };

        const checkListData = ["è­·ç…§å…¨å“¡", "VIP æ†‘è­‰", "ç¶²å¡/Wifi", "æ—¥åœ“ç¾é‡‘", "ä¿æš–å¤–å¥—", "è—¥å“åŒ…"];
        let user = null, expenses = [], exchangeRate = 0.211;

        window.closeModal = () => document.getElementById('tool-modal').classList.add('hidden');

        window.toggleTool = (type, day, idx) => {
            const modal = document.getElementById('tool-modal'), body = document.getElementById('modal-body');
            if (!modal || !body) return;
            modal.classList.remove('hidden');
            body.innerHTML = '<div class="p-20 text-center"><i class="fas fa-circle-notch fa-spin text-4xl mb-4 text-left"></i><p>è³‡æ·±å°éŠæ­£åœ¨æº–å‚™æ”»ç•¥...</p></div>';
            
            setTimeout(() => {
                if (type === 'calc') {
                    body.innerHTML = `<div class="p-10 text-left fade-in text-left text-left"><h3 class="text-3xl font-black kaity mb-6 text-left">åŒ¯ç‡æ›ç®—</h3><div class="mb-6 bg-yellow-50 p-6 rounded-3xl border border-yellow-100 text-left text-left"><p class="text-[10px] text-yellow-600 font-bold text-left">ç›®å‰åŒ¯ç‡</p><p class="text-xl font-bold font-mono text-left">${window.liveRateText || '1 JPY = 0.211 TWD'}</p></div><div class="mb-8 text-left text-left text-left"><label class="text-[11px] font-black text-gray-400 block mb-2 font-mono text-left text-left text-left">æ—¥åœ“ (JPY)</label><input type="number" id="jpy-input" class="w-full text-5xl font-black border-b-4 border-[--osaka-gold] py-4 outline-none bg-transparent" oninput="window.runConversion()" placeholder="Â¥"></div><div><label class="text-[11px] font-black text-gray-400 block mb-2 font-mono text-left">å°å¹£ (TWD)</label><p id="twd-output" class="text-6xl font-black text-[--kyoto-red] mt-2 text-left">0</p></div></div>`;
                } else if (type === 'ledger') {
                    body.innerHTML = `<div class="p-8 text-left fade-in text-left text-left text-left text-left text-left"><h3 class="text-3xl font-black kaity mb-6">å®¶æ—è¨˜å¸³</h3><div class="bg-emerald-600 p-8 rounded-[2.5rem] shadow-xl text-white mb-8 text-center text-left text-left text-left text-left"><p class="text-emerald-100 text-xs mb-1 font-mono text-left text-left">åˆ†æ”¤ç¸½è¨ˆ (8ä½)</p><p id="ledger-total-jpy" class="text-4xl font-black font-mono text-center text-left text-left text-left">Â¥ 0</p></div><div class="flex gap-3 mb-8 text-left text-left text-left text-left text-left"><input type="text" id="ledger-item-name" placeholder="å“é …" class="flex-1 bg-white rounded-2xl p-4 outline-none border border-gray-100 text-left text-left text-left text-left text-left"><input type="number" id="ledger-item-amount" placeholder="Â¥" class="w-24 bg-white rounded-2xl p-4 outline-none border border-gray-100 font-mono text-left text-left text-left text-left text-left"><button onclick="window.addExpense()" class="bg-emerald-600 text-white w-14 rounded-2xl flex items-center justify-center btn-press text-left text-left text-left text-left text-left text-left"><i class="fas fa-plus text-left text-left text-left text-left text-left text-left"></i></button></div><div id="ledger-list" class="space-y-4 mb-8"></div><div class="mt-10 pt-8 border-t border-gray-100 text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left"><a href="https://liff.line.me/1655320992-Y8GowEpw/g/2jGf3BAwhK1jsbnwmPN7BQ" target="_blank" class="block w-full py-5 bg-[#06C755] text-white rounded-[2rem] text-center text-sm font-black shadow-lg btn-press flex items-center justify-center gap-3 text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left"><i class="fab fa-line text-2xl text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left"></i>é–‹å•Ÿåˆ†å¸³ç¾¤çµ„</a></div></div>`;
                    renderLedger();
                } else if (type === 'checklist') {
                    body.innerHTML = `<div class="p-10 text-left fade-in text-left text-left text-left text-left text-left text-left text-left text-left text-left"><h3 class="text-3xl font-black kaity mb-6 text-left text-left text-left text-left text-left text-left text-left">è¡Œå‰æ¸…å–®</h3><div class="space-y-4 text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left">${checkListData.map(text => `<label class="checklist-item flex items-center gap-4 bg-white p-5 rounded-2xl border border-gray-100 shadow-sm text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left"><input type="checkbox" class="w-6 h-6 rounded-lg border-gray-300 text-[--kyoto-red] focus:ring-[--kyoto-red] text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left"><span class="text-sm font-bold text-gray-700 text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left">${text}</span></label>`).join('')}</div></div>`;
                } else if (type === 'detail') {
                    const d = tourData[day].events[idx];
                    body.innerHTML = `
                        <div class="fade-in">
                            <div class="modal-immersive-header" style="background-image: url('${d.imgDetail}')">
                                <div class="modal-immersive-overlay text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left"></div>
                                <div class="absolute bottom-8 left-10 right-10 z-10 text-left text-left text-left text-left text-left text-left text-left text-left">
                                    <span class="badge-spot text-[10px] px-5 py-2 rounded-full font-black mb-3 inline-block shadow-sm text-left text-left text-left text-left text-left text-left text-left text-left">${d.type}</span>
                                    <h2 class="text-4xl font-black text-gray-900 kaity text-shadow-premium leading-tight text-left text-left text-left text-left text-left text-left text-left text-left text-left">${d.detailTitle}</h2>
                                </div>
                            </div>
                            <div class="px-10 pb-16 pt-8 space-y-10 text-left text-left text-left text-left text-left text-left text-left text-left">
                                <section><h4 class="text-2xl font-black kaity border-l-4 border-[--kyoto-red] pl-4 mb-3 text-left">è©³ç´°è¦åŠƒèˆ‡å°è¦½</h4><p class="text-[15px] leading-relaxed text-gray-600 font-medium text-left text-left text-left text-left">${d.intro || 'è©³ç´°è·¯ç·šè¦åŠƒä¸­ï¼Œå°‡æä¾›æœ€é †æš¢çš„é«”é©—ã€‚'}</p></section>
                                <section class="bg-white p-7 rounded-[2.5rem] border border-gray-100 shadow-sm text-left text-left text-left text-left text-left text-left text-left text-left text-left"><h4 class="text-xl font-black kaity text-[--kyoto-red] mb-3 text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left"><i class="fas fa-user-tie mr-2 text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left"></i>è³‡æ·±å°éŠè§€é»</h4><p class="text-[14px] font-bold italic text-gray-700 text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left">${d.aiGuide || 'é¦–å¸­å°éŠï¼šç¥æ‚¨è¡Œç¨‹é †å¿ƒã€‚'}</p></section>
                                ${d.vegNote ? `<section class="bg-emerald-50 p-7 rounded-[2.5rem] border border-emerald-100 text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left"><h4 class="text-xl font-black kaity text-emerald-700 mb-2 text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left"><i class="fas fa-leaf mr-2 text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left"></i>è”¬é£Ÿå°èˆª</h4><p class="text-[14px] font-bold text-emerald-800 text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left">${d.vegNote}</p></section>` : ''}
                                <a href="https://www.google.com/maps/search/?api=1&query=${d.m}" target="_blank" class="block w-full py-5 bg-gray-900 text-white rounded-[2rem] text-center text-lg font-black kaity shadow-xl btn-press text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left">é–‹å•Ÿ Google åœ°åœ–å°å¼•</a>
                            </div>
                        </div>`;
                }
            }, 50);
        };

        window.runConversion = () => {
            const jpy = document.getElementById('jpy-input')?.value, output = document.getElementById('twd-output');
            if (output && jpy) output.innerText = (parseFloat(jpy) * exchangeRate).toLocaleString('zh-TW', {maximumFractionDigits: 1});
        };

        async function updateWeatherUI(city, eng) {
            const coords = eng === "Osaka" ? "latitude=34.69&longitude=135.50" : "latitude=35.01&longitude=135.77";
            try {
                const res = await fetch(`https://api.open-meteo.com/v1/forecast?${coords}&current_weather=true`);
                if (!res.ok) return;
                const d = await res.json(), temp = Math.round(d.current_weather.temperature);
                document.getElementById('weather-city-name').innerText = city;
                document.getElementById('weather-temp-calligraphy').innerText = `${temp}Â°C`;
            } catch (e) {}
        }

        window.switchDay = (d) => {
            const data = tourData[d]; if (!data) return;
            document.querySelectorAll('#day-nav-container button').forEach(b => b.classList.remove('tab-active'));
            document.getElementById(`tab${d}`).classList.add('tab-active');
            document.getElementById('header-bg').src = data.img;
            const ring = document.getElementById('stamina-ring'), dash = 176 - (176 * (data.stamina || 100) / 100);
            ring.style.strokeDashoffset = dash; document.getElementById('stamina-val').innerText = (data.stamina || 100) + '%';
            let html = `<div class="fade-in space-y-6 text-left">`;
            data.events.forEach((e, idx) => {
                let isStay = e.type === 'ä½å®¿';
                let badgeClass = isStay ? 'badge-stay' : (e.type === 'ç¾é£Ÿ' || e.type === 'é«”é©—' || e.type === 'è³¼ç‰©' ? 'badge-food' : 'badge-spot');
                let cardClass = isStay ? 'card-stay shadow-lg' : 'bg-white shadow-sm border border-gray-100';
                html += `<div class="relative pl-8 mb-8 border-l-2 border-dashed border-gray-200 text-left text-left text-left" onclick="window.toggleTool('detail', ${d}, ${idx})"><div class="absolute -left-2 top-0 w-4 h-4 rounded-full ${isStay ? 'bg-[--osaka-gold]' : 'bg-[--kyoto-red]'} border-4 border-white shadow-md text-left text-left text-left text-left"></div><div class="${cardClass} rounded-[2.5rem] p-7 active:scale-[0.97] transition-all text-left text-left text-left"><div class="flex justify-between items-center mb-4 text-left text-left text-left text-left text-left"><span class="${isStay ? 'bg-amber-600' : 'bg-[--bamboo-green]'} text-white text-[9px] px-3 py-1 rounded-full font-bold shadow-sm text-left text-left text-left">${e.t}</span><div class="flex gap-2 text-left text-left text-left text-left text-left text-left">${e.reserved ? `<span class="bg-amber-100 text-amber-600 text-[8px] font-black px-2 py-1 rounded-lg border border-amber-200 text-left text-left text-left">é ç´„</span>` : ''}<span class="${badgeClass} text-[8px] font-black px-2.5 py-1 rounded-lg text-left text-left text-left text-left text-left text-left text-left">${e.type}</span></div></div><h3 class="text-xl font-bold mb-2 kaity flex items-center text-left text-left text-left text-left text-left text-left text-left text-left"><i class="fas fa-${e.i || 'map-marker-alt'} mr-3 ${isStay ? 'text-[--osaka-gold]' : 'text-[--kyoto-red]'} text-lg opacity-80 text-left text-left text-left text-left text-left text-left text-left"></i>${e.s}</h3><p class="text-xs font-bold mb-4 line-clamp-1 opacity-80 text-left text-left text-left text-left text-left text-left text-left text-left text-left">${e.n}</p><div class="${isStay ? 'bg-white/10' : 'bg-red-50'} px-4 py-2.5 rounded-2xl text-[10px] font-black border border-white/20 flex items-center justify-between text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left"><span><i class="fas fa-eye mr-2 text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left"></i>${isStay ? 'æŸ¥çœ‹é£¯åº—ç‰¹è‰²' : 'æŸ¥çœ‹è©³æƒ…æ”»ç•¥'}</span><i class="fas fa-chevron-right text-[8px] opacity-40 text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left"></i></div></div></div>`;
            });
            document.getElementById('main-content').innerHTML = html + `</div>`;
            updateWeatherUI(data.loc, data.engLoc); window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        window.onload = async () => {
            const nav = document.getElementById('day-nav-container'), dayNames = ["ç¬¬ä¸€æ—¥", "ç¬¬äºŒæ—¥", "ç¬¬ä¸‰æ—¥", "ç¬¬å››æ—¥", "ç¬¬äº”æ—¥", "ç¬¬å…­æ—¥"];
            nav.innerHTML = dayNames.map((n, i) => `<button onclick="window.switchDay(${i+1})" id="tab${i+1}" class="px-8 py-3 rounded-[1.5rem] bg-white text-gray-400 shadow-sm border border-gray-100 font-black transition-all text-xs text-center text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left">${n}</button>`).join('');
            try { window.switchDay(1); } catch (e) {}
            try {
                const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : { apiKey: "preview" };
                const app = initializeApp(firebaseConfig), auth = getAuth(app), db = getFirestore(app);
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'kansai-pro-2025';
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) { await signInWithCustomToken(auth, __initial_auth_token); } else { await signInAnonymously(auth); }
                onAuthStateChanged(auth, (u) => {
                    user = u; if (user) {
                        onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'expenses'), (snapshot) => {
                            expenses = snapshot.docs.map(d => ({ id: d.id, ...d.data() })).sort((a, b) => b.timestamp - a.timestamp);
                        });
                    }
                });
                const rateRes = await fetch('https://open.er-api.com/v6/latest/JPY');
                if (rateRes.ok) { const rateData = await rateRes.json(); exchangeRate = rateData.rates.TWD; window.liveRateText = `1 JPY = ${exchangeRate.toFixed(3)} TWD`; }
            } catch (e) {}
        };
    </script>
</body>
</html>
